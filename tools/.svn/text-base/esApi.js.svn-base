var request = require('request');
module.exports = function(data,opt){

    console.log('request',data);
    var users = data.user;
    var productLines = data.productLineResult;
    var mq = [];
    for(user in users){
        mq.push('key=14936417&type=user&name='+user+'&add='+users[user]['add']+'&remove='+users[user]['remove'])
        // console.log('key=14936417&type=user&name='+user+'&add='+users[user]['add']+'&remove='+users[user]['remove'])
    }
    for(product in productLines){
        mq.push('key=14936417&type=product&mod='+product+'&add='+productLines[product]['add']+'&submitCount='+productLines[product]['submitCount']);
        // console.log('key=14936417&type=product&mod='+product+'&add='+productLines[product]['add']+'&submitCount='+productLines[product]['submitCount'])
    }
    // mq.forEach(function(item){
    //     console.log('"'+item+'",');
    //     console.log('http://letsgo.e.weibo.com/stracker/fe/report?'+item);
    // })
    var day = opt.date.now.day*1-1;
    var month = opt.date.now.month;
    if (day < 10) {
        day = "0" + day;
    }
    if (month < 10) {
        month = "0" + month;
    }

    var obj = {
        "date":opt.date.now.year+'-'+month+'-'+day,
        "data":mq
    }
    console.log('esapi',obj);
    request.post({
        uri:'http://rocket.mcp.wap.grid.sina.com.cn/bee/es/save',
        headers: {referer: 'http://weibo.com'},
        body:JSON.stringify(obj)
    },function (error, response, body) {
        // console.log('request response',error,response,body)
        if (!error && response.statusCode == 200) {
            console.log('send request for ',opt.date.now.year+'-'+opt.date.now.month+'-'+opt.date.now.day);
        }else{
            console.log('error',error,opt.date.now.year+'-'+opt.date.now.month+'-'+opt.date.now.day)
        }
    })
}
